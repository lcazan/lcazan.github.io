<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Snoozing Builder | v3.39 Edge-to-Edge</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --panel-bg: #2d2d2d; --brand-pink: #ebd5c9; }
        body { margin: 0; display: flex; height: 100vh; width: 100vw; font-family: sans-serif; background: #111; overflow: hidden; position: fixed; touch-action: none; }
        #sidebar { width: 90px; height: 100vh; background: var(--panel-bg); display: flex; flex-direction: column; align-items: center; padding: 20px 0; border-right: 2px solid #000; flex-shrink: 0; z-index: 1000; }
        .insert-btn { width: 65px; height: 65px; background: #444; border: 1px solid #666; color: #fff; margin-bottom: 15px; border-radius: 8px; cursor: pointer; font-size: 9px; font-weight: bold; text-transform: uppercase; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 5px; }
        #preview-container { flex-grow: 1; display: flex; flex-direction: column; background: #333; height: 100vh; overflow: hidden; }
        #header-area { background: #222; border-bottom: 1px solid #000; height: 50px; flex-shrink: 0; position: relative; display: flex; align-items: center; justify-content: center; }
        .device-btn { background: transparent; border: none; color: #fff; cursor: pointer; font-size: 24px; margin: 0 15px; }
        .device-btn.active { color: var(--brand-pink); }
        #frame-wrapper { flex-grow: 1; display: flex; justify-content: center; align-items: flex-start; background: #333; overflow: hidden; position: relative; }
        #preview-frame { border: none; background: white; transform-origin: top center; transition: transform 0.2s ease; }
    </style>
</head>
<body>

<div id="sidebar">
    <button class="insert-btn" onclick="insertElement('section_heading')"><i class="fa-solid fa-heading"></i>Section</button>
    <button class="insert-btn" onclick="insertElement('block_heading')"><i class="fa-solid fa-font"></i>Heading</button>
    <button class="insert-btn" onclick="insertElement('block_text')"><i class="fa-solid fa-align-left"></i>Text</button>
    <button class="insert-btn" style="margin-top:auto" onclick="saveJSON()"><i class="fa-solid fa-floppy-disk"></i>Save</button>
</div>

<div id="preview-container">
    <div id="header-area">
        <button class="device-btn" id="btn-desktop" onclick="setDevice('desktop')"><i class="fa-solid fa-desktop"></i></button>
        <button class="device-btn" id="btn-mobile" onclick="setDevice('mobile')"><i class="fa-solid fa-mobile-screen-button"></i></button>
    </div>
    <div id="frame-wrapper">
        <iframe id="preview-frame"></iframe>
    </div>
</div>

<script>
    const frame = document.getElementById('preview-frame');
    const wrapper = document.getElementById('frame-wrapper');
    let lockedHeight = 0;
    let initialWidth = window.innerWidth;
    let currentMode = 'mobile';

    async function init() {
        updateLockedHeight();
        const resp = await fetch('template.html');
        let html = await resp.text();
        
        // Inject Editor overrides
        html = html.replace('</head>', `<style>.selected-item { outline: 3px solid #ebd5c9 !important; } .editable { cursor: pointer; }</style></head>`);
        
        // Target the empty content-container for editing
        frame.srcdoc = html.replace('<div class="content-container">', '<div class="content-container" id="editor-root">');
        
        frame.onload = () => {
            frame.contentDocument.addEventListener('mousedown', (e) => {
                const el = e.target.closest('.editable');
                if (el) selectElement(el);
            });
            setDevice('mobile');
        };

        window.visualViewport.addEventListener('resize', () => {
            if (window.innerWidth !== initialWidth) {
                initialWidth = window.innerWidth;
                updateLockedHeight();
                if(currentMode === 'mobile') setDevice('mobile');
            }
        });
    }

    function updateLockedHeight() {
        lockedHeight = window.innerHeight - 50; 
    }

    function setDevice(type) {
        currentMode = type;
        document.querySelectorAll('.device-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(type === 'mobile' ? 'btn-mobile' : 'btn-desktop').classList.add('active');

        if (type === 'mobile') {
            const physicalWidth = wrapper.offsetWidth;
            const scaleFactor = physicalWidth / 412;
            frame.style.width = '412px';
            frame.style.height = (lockedHeight / scaleFactor) + 'px';
            frame.style.transform = `scale(${scaleFactor})`;
        } else {
            frame.style.width = '100%';
            frame.style.height = '100%';
            frame.style.transform = 'none';
        }
    }

    function insertElement(type) {
        const doc = frame.contentDocument;
        const root = doc.getElementById('editor-root');
        const el = doc.createElement('div');
        el.className = `editable ${type}`;
        el.contentEditable = "true";
        el.innerText = "New Block";
        root.appendChild(el);
    }

    function selectElement(el) {
        if(window.selectedEl) window.selectedEl.classList.remove('selected-item');
        window.selectedEl = el;
        el.classList.add('selected-item');
    }

    window.onload = init;
</script>
</body>
</html>
