<div id="sidebar">
    <button class="insert-btn" onclick="insertElement('block_image')" title="Insert Image"><i class="fa-solid fa-image"></i></button>
    <button class="insert-btn" onclick="insertElement('block_button')" title="Insert Button"><i class="fa-solid fa-square"></i></button>
    </div>

<div id="sticky-toolbar">
    <div id="toolbar-content">
        <button class="tool-btn" onclick="setAlign('left')"><i class="fa-solid fa-align-left"></i></button>
        <button class="tool-btn" onclick="setAlign('center')"><i class="fa-solid fa-align-center"></i></button>
        <button class="tool-btn" onclick="setAlign('right')"><i class="fa-solid fa-align-right"></i></button>
        
        <div id="link-control" style="display:none; margin-left: 15px; border-left: 1px solid #444; padding-left: 15px; align-items: center;">
            <i class="fa-solid fa-link" style="color: #888; margin-right: 8px; font-size: 12px;"></i>
            <input type="text" id="btn-link" placeholder="Button Link (URL)" oninput="updateBtnLink(this.value)" 
                   style="background:#444; color:white; border:none; padding:6px; border-radius:3px; width:180px; font-size:12px;">
        </div>

        <button class="tool-btn" style="color:#ff6b6b" onclick="deleteElement()"><i class="fa-solid fa-trash"></i></button>
    </div>
</div>

<script>
    // Updated Selection Logic to handle Link UI
    function selectElement(el) {
        if (selectedEl) selectedEl.classList.remove('selected-item');
        selectedEl = el;
        selectedEl.classList.add('selected-item');
        
        const linkControl = document.getElementById('link-control');
        const btnInput = document.getElementById('btn-link');
        
        // Show link input if the wrapper contains a button
        const btn = el.querySelector('.block_button');
        if (btn) {
            linkControl.style.display = 'flex';
            btnInput.value = btn.getAttribute('href') || '';
        } else {
            linkControl.style.display = 'none';
        }
    }

    function updateBtnLink(val) {
        if (!selectedEl) return;
        const btn = selectedEl.querySelector('.block_button');
        if (btn) btn.setAttribute('href', val);
    }

    function setAlign(pos) {
        if (!selectedEl) return;
        // Buttons use flex alignment on the wrapper
        if (selectedEl.classList.contains('button-wrapper')) {
            const flexMap = { 'left': 'flex-start', 'center': 'center', 'right': 'flex-end' };
            selectedEl.style.justifyContent = flexMap[pos];
        } else {
            selectedEl.style.textAlign = pos;
        }
    }

    function insertElement(type) {
        const doc = frame.contentDocument;
        const root = doc.getElementById('editor-root');
        let el;

        if (type === 'block_button') {
            el = doc.createElement('div');
            el.className = 'editable button-wrapper';
            el.innerHTML = `<a href="#" class="block_button" contenteditable="true">Find Out More</a>`;
        } else {
            // ... existing text/image logic ...
            el = doc.createElement('div');
            el.className = `editable ${type}`;
            el.contentEditable = "true";
        }

        root.appendChild(el);
        setTimeout(() => selectElement(el), 100);
    }
</script>
