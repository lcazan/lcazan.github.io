<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Snoozing Builder | v3.9.5</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --admin-bg: #1e1e1e; --panel-bg: #2d2d2d; --brand-pink: #ebd5c9; }
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; position: fixed; top: 0; left: 0; background: #111; touch-action: none; }
        body { display: flex; font-family: 'Source Sans Pro', sans-serif; }
        #sidebar { width: 75px; height: 100%; background: var(--panel-bg); display: flex; flex-direction: column; align-items: center; padding: 15px 0; border-right: 2px solid #000; flex-shrink: 0; z-index: 1000; }
        .insert-btn { width: 60px; height: 32px; background: #444; border: 1px solid #666; color: #fff; margin: 0 5px 10px 5px; border-radius: 4px; cursor: pointer; font-size: 14px; display: flex; justify-content: center; align-items: center; }
        #preview-container { flex-grow: 1; display: flex; flex-direction: column; background: #333; height: 100%; overflow: hidden; position: relative; }
        #header-area { background: #222; border-bottom: 1px solid #000; flex-shrink: 0; z-index: 500; height: 50px; position: relative; }
        #device-bar { height: 100%; display: flex; align-items: center; justify-content: center; }
        .device-btn { background: transparent; border: none; color: #fff; cursor: pointer; font-size: 26px; margin: 0 15px; }
        .device-btn.active { color: var(--brand-pink); }
        .version-status { position: absolute; right: 25px; top: 12px; color: #fff; font-size: 16px; font-weight: 800; }
        #sticky-toolbar { height: 48px; background: #1a1a1a; display: flex; align-items: center; justify-content: center; border-bottom: 1px solid #000; flex-shrink: 0; }
        #toolbar-content { display: flex; gap: 8px; visibility: hidden; align-items: center; height: 100%; }
        .tool-btn { background: #444; border: 1px solid #666; color: white; border-radius: 4px; cursor: pointer; font-size: 20px; min-width: 40px; height: 38px; display: flex; align-items: center; justify-content: center; }
        .tool-input { background: #333; border: 1px solid #666; color: #fff; padding: 5px; border-radius: 4px; width: 120px; }
        #frame-wrapper { flex-grow: 1; display: flex; justify-content: center; align-items: flex-start; background: #333; overflow: hidden; position: relative; }
        #preview-frame { border: none; background: white; transform-origin: top left; position: absolute; top: 0; left: 0; }
    </style>
</head>
<body>

<div id="sidebar">
    <button class="insert-btn" title="Section" onclick="insertElement('block_container')"><i class="fa-solid fa-square"></i></button>
    <button class="insert-btn" title="Button" onclick="insertElement('block_button')"><i class="fa-solid fa-circle-dot"></i></button>
    <button class="insert-btn" title="Section Heading" onclick="insertElement('section_heading')"><i class="fa-solid fa-heading"></i></button>
    <button class="insert-btn" title="Block Heading" onclick="insertElement('block_heading')"><i class="fa-solid fa-font"></i></button>
    <button class="insert-btn" title="Text" onclick="insertElement('block_text')"><i class="fa-solid fa-align-left"></i></button>
    <button class="insert-btn" title="Image" onclick="triggerImageUpload()"><i class="fa-solid fa-image"></i></button>
    <button class="insert-btn" title="Spacer" onclick="insertElement('block_spacer')"><i class="fa-solid fa-arrows-up-down"></i></button>
</div>

<div id="preview-container">
    <div id="header-area">
        <div id="device-bar">
            <button class="device-btn" id="btn-desktop" onclick="setDevice('desktop')"><i class="fa-solid fa-desktop"></i></button>
            <button class="device-btn" id="btn-mobile" onclick="setDevice('mobile')"><i class="fa-solid fa-mobile-screen-button"></i></button>
            <div class="version-status">v3.9.5</div>
        </div>
    </div>
    <div id="sticky-toolbar"><div id="toolbar-content"></div></div>
    <div id="frame-wrapper"><iframe id="preview-frame"></iframe></div>
</div>

<input type="file" id="image-upload" style="display:none" accept="image/*" onchange="handleImageUpload(this)">

<script>
    const frame = document.getElementById('preview-frame');
    const toolbarContent = document.getElementById('toolbar-content');
    const wrapper = document.getElementById('frame-wrapper');
    let selectedEl = null;
    let currentMode = 'mobile';

    async function init() {
        const resp = await fetch('template.html');
        let html = await resp.text();
        html = html.replace('</head>', `<link rel="stylesheet" href="styles.css"></head>`);
        frame.srcdoc = html.replace(/<div class="content-container">([\s\S]*?)<\/div>/, '<div class="content-container" id="editor-root">$1</div>');
        frame.onload = () => {
            frame.contentDocument.addEventListener('mousedown', (e) => {
                const el = e.target.closest('.editable');
                if (el) selectElement(el); else deselectAll();
            });
            setDevice('mobile');
        };
    }

    function setDevice(type) {
        currentMode = type;
        const virtualWidth = (type === 'mobile') ? 412 : 1280;
        const scaleFactor = wrapper.offsetWidth / virtualWidth;
        frame.style.width = virtualWidth + 'px';
        frame.style.height = (wrapper.offsetHeight / scaleFactor) + 'px';
        frame.style.transform = `scale(${scaleFactor})`;
    }

    function selectElement(el) {
        if(selectedEl) selectedEl.classList.remove('selected-item');
        selectedEl = el;
        selectedEl.classList.add('selected-item');
        renderToolbar();
    }

    function deselectAll() {
        if (selectedEl) selectedEl.classList.remove('selected-item');
        selectedEl = null;
        toolbarContent.style.visibility = 'hidden';
    }

    function renderToolbar() {
        if (!selectedEl) return;
        toolbarContent.style.visibility = 'visible';
        const isBtn = selectedEl.classList.contains('block_button_container');
        let html = '';

        if (isBtn) {
            const btn = selectedEl.querySelector('a');
            html += `<input type="text" class="tool-input" placeholder="Button Text" value="${btn.innerText}" oninput="updateBtnText(this.value)">`;
            html += `<input type="text" class="tool-input" placeholder="Link (URL)" value="${btn.getAttribute('href') || ''}" oninput="updateBtnLink(this.value)">`;
        } else if (!selectedEl.classList.contains('block_spacer') && !selectedEl.classList.contains('block_container')) {
            html += `<button class="tool-btn" onclick="execCmd('bold')"><i class="fa-solid fa-bold"></i></button>`;
        }
        
        html += `<button class="tool-btn" style="color:#ff6b6b" onclick="deleteElement()"><i class="fa-solid fa-trash"></i></button>`;
        toolbarContent.innerHTML = html;
    }

    function updateBtnText(val) { if(selectedEl) selectedEl.querySelector('a').innerText = val; }
    function updateBtnLink(val) { if(selectedEl) selectedEl.querySelector('a').setAttribute('href', val); }
    function deleteElement() { if(selectedEl) { selectedEl.remove(); deselectAll(); } }

    function insertElement(type) {
        const doc = frame.contentDocument;
        const root = doc.getElementById('editor-root');
        const el = doc.createElement('div');
        el.className = `editable ${type === 'block_button' ? 'block_button_container' : type}`;

        if(type === 'block_button') {
            el.innerHTML = `<a href="#" class="block_button" onclick="return false;">Find Out More</a>`;
        } else if(type === 'block_spacer' || type === 'block_container') {
            el.style.minHeight = "50px";
        } else {
            el.contentEditable = "true";
            el.innerText = "New Element";
        }

        if (selectedEl && selectedEl.classList.contains('block_container')) {
            selectedEl.appendChild(el);
        } else if (selectedEl) {
            selectedEl.after(el);
        } else {
            root.appendChild(el);
        }
        
        setTimeout(() => selectElement(el), 50);
    }

    window.onload = init;
</script>
</body>
</html>
