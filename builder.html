<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Snoozing Builder | v4.3.66</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --admin-bg: #1e1e1e; --panel-bg: #2d2d2d; --brand-pink: #ebd5c9; --side-w: 4.6875rem; --head-h: 3.125rem; --tool-h: 3rem; }
        
        html, body { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background: #111; display: block; 
        }

        /* SIDEBAR: Scrollable and Layered on top */
        #sidebar {  
            position: fixed; top: 0; left: 0; 
            width: var(--side-w); height: 100vh; 
            background: var(--panel-bg); border-right: 0.125rem solid #000;
            display: flex; flex-direction: column; align-items: center; 
            padding: 0.9375rem 0; z-index: 3000; box-sizing: border-box;
            overflow-y: auto; overflow-x: hidden; 
            scrollbar-width: none; /* Firefox */
        }
        #sidebar::-webkit-scrollbar { display: none; } /* Chrome/Safari */

        #header-area { 
            position: fixed; top: 0; left: var(--side-w); right: 0;
            height: var(--head-h); background: #222; 
            border-bottom: 0.0625rem solid #000; 
            display: flex; align-items: center; justify-content: center; z-index: 1001; 
        }

        #sticky-toolbar { 
            position: fixed; top: var(--head-h); left: var(--side-w); right: 0;
            height: var(--tool-h); background: #1a1a1a; 
            border-bottom: 0.0625rem solid #000; 
            display: flex; align-items: center; justify-content: center; z-index: 1001; 
        }

        #toolbar-content { 
            position: relative; width: 90%; height: 2.2rem; visibility: hidden; 
        }

        .tool-btn, .tool-input { 
            position: absolute; top: 0; height: 2.2rem;
            transition: width 0.25s ease-out; box-sizing: border-box;
        }

        .tool-btn { 
            background: #444; border: 0.0625rem solid #666; color: white; 
            width: 2.2rem; border-radius: 0.25rem; display: flex; 
            align-items: center; justify-content: center; cursor: pointer; z-index: 12; 
        }

        .tool-input { 
            background: #333; border: 0.0625rem solid #666; color: #fff; 
            padding: 0 8px; border-radius: 0.25rem; font-size: 0.75rem; 
            z-index: 10; width: 45px; 
        }

        .p0 { left: 0px; }
        .p1 { left: 49px; }
        .p2 { left: 98px; }
        .p3 { left: 147px; }

        .tool-input:focus { width: 100% !important; z-index: 20 !important; background: #222; outline: 1px solid var(--brand-pink); }

        #frame-wrapper { 
            position: fixed; top: calc(var(--head-h) + var(--tool-h)); 
            left: var(--side-w); right: 0; bottom: 0;
            background: #333; overflow: hidden; 
        }

        #preview-frame { border: none; background: white; transform-origin: top left; position: absolute; top: 0; left: 0; }

        .insert-btn { width: 3.75rem; height: 2rem; background: #444; border: 0.0625rem solid #666; color: #fff; margin-bottom: 0.625rem; border-radius: 0.25rem; cursor: pointer; display: flex; justify-content: center; align-items: center; font-size: 1.2rem; font-weight: bold; flex-shrink: 0; }
        .device-btn { background: transparent; border: none; color: #fff; cursor: pointer; font-size: 1.5rem; margin: 0 0.6rem; }
        .device-btn.active { color: var(--brand-pink); }
        .export-wrap { margin-top: auto; padding: 20px 0; flex-shrink: 0; }
        .export-btn { width: 3.75rem; height: 3.75rem; background: var(--brand-pink); border: none; color: #000; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.5rem; cursor: pointer; }
        .version-status { position: absolute; right: 1.5625rem; top: 0.75rem; color: #fff; font-size: 1rem; font-weight: 800; }
    </style>
</head>
<body>

<div id="sidebar">
    <button class="insert-btn" onclick="insertElement('block_container')"><i class="fa-solid fa-square"></i></button>
    <button class="insert-btn" onclick="triggerImageUpload()"><i class="fa-solid fa-image"></i></button>
    <button class="insert-btn" onclick="insertElement('section_heading')">T1</button>
    <button class="insert-btn" onclick="insertElement('block_heading')">T2</button>
    <button class="insert-btn" onclick="insertElement('block_text')">T3</button>
    <button class="insert-btn" onclick="insertElement('block_button')">Btn</button>
    <button class="insert-btn" onclick="insertElement('block_spacer')"><i class="fa-solid fa-arrows-up-down"></i></button>
    <div class="export-wrap"><button class="export-btn" onclick="exportHTML()"><i class="fa-solid fa-download"></i></button></div>
</div>

<div id="header-area">
    <div id="device-bar">
        <button class="device-btn" id="btn-desktop" onclick="setDevice('desktop')"><i class="fa-solid fa-desktop"></i></button>
        <button class="device-btn" id="btn-android" onclick="setDevice('android')"><i class="fa-solid fa-mobile-screen-button"></i></button>
        <button class="device-btn" id="btn-iphone" onclick="setDevice('iphone')"><i class="fa-solid fa-mobile"></i></button>
    </div>
    <div class="version-status">v4.3.66</div>
</div>

<div id="sticky-toolbar"><div id="toolbar-content"></div></div>

<div id="frame-wrapper">
    <iframe id="preview-frame" scrolling="yes"></iframe>
</div>

<input type="file" id="image-upload" style="display:none" accept="image/*" onchange="handleImageUpload(this)">

<script>
    const frame = document.getElementById('preview-frame');
    const toolbarContent = document.getElementById('toolbar-content');
    const wrapper = document.getElementById('frame-wrapper');
    let selectedEl = null; let currentMode = 'iphone';

    async function init() {
        const resp = await fetch('template.html');
        let html = await resp.text();
        frame.srcdoc = html.replace('</head>', `
            <style>
                #editor-root { width: 100%; display: flex; flex-direction: column; padding-bottom: 250px; }
                .editable { position: relative; min-height: 1.2em; cursor: pointer; outline: none; }
                .selected-item { outline: 0.1875rem solid #ebd5c9 !important; }
                .block_button_container { display: flex; justify-content: center; padding: 10px; }
                .block_button { background: #000; color: #fff; padding: 10px 20px; text-decoration: none; display: inline-block; font-weight: bold; }
            </style>
        `).replace(/<div class="content-container">([\s\S]*?)<\/div>/, '<div class="content-container" id="editor-root">$1</div>');
        
        frame.onload = () => { 
            setDevice('iphone');
            frame.contentDocument.addEventListener('mousedown', (e) => {
                const el = e.target.closest('.editable') || e.target.closest('.block_button_container');
                if (el) selectElement(el); else deselectAll();
            });
        };
    }

    function insertElement(type) {
        const doc = frame.contentDocument;
        const root = doc.getElementById('editor-root');
        if (!root) return;

        const tagMap = { 'section_heading': 'h2', 'block_heading': 'h3', 'block_text': 'p' };
        let el;

        if (type === 'block_button') {
            el = doc.createElement('div');
            el.className = 'block_button_container';
            el.innerHTML = '<a href="#" class="block_button" onclick="return false;">FIND OUT MORE</a>';
        } else if (type === 'block_container') {
            el = doc.createElement('div');
            el.className = 'block_container editable';
            el.style.minHeight = '50px';
            el.style.background = '#f9f9f9';
        } else {
            el = doc.createElement(tagMap[type] || 'div');
            el.className = 'editable ' + type;
            el.innerText = 'New ' + type.replace('_', ' ');
            el.contentEditable = "true";
        }

        root.appendChild(el);
        selectElement(el);
    }

    function triggerImageUpload() { document.getElementById('image-upload').click(); }
    
    function handleImageUpload(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const doc = frame.contentDocument;
                const root = doc.getElementById('editor-root');
                const div = doc.createElement('div');
                div.className = 'block_image editable';
                div.innerHTML = `<img src="${e.target.result}" style="width:100%">`;
                root.appendChild(div);
                selectElement(div);
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function selectElement(el) {
        if(selectedEl) selectedEl.classList.remove('selected-item');
        selectedEl = el; selectedEl.classList.add('selected-item');
        renderToolbar();
    }

    function deselectAll() { 
        if(selectedEl) selectedEl.classList.remove('selected-item'); 
        selectedEl = null; toolbarContent.style.visibility = 'hidden'; 
    }

    function renderToolbar() {
        if (!selectedEl) return;
        toolbarContent.style.visibility = 'visible';
        const isBtn = selectedEl.classList.contains('block_button_container');
        let html = '';

        if (isBtn) {
            const link = selectedEl.querySelector('a');
            const url = link.getAttribute('href') || '';
            const txt = link.innerText;
            html += `<input type="text" class="tool-input p0" value="href" onfocus="this.value='${url}'" onblur="updateBtnLink(this.value); this.value='href'">`;
            html += `<input type="text" class="tool-input p1" value="text" onfocus="this.value='${txt}'" onblur="updateBtnText(this.value); this.value='text'">`;
            html += `<button class="tool-btn p2" style="color:#ff6b6b" onclick="deleteElement()"><i class="fa-solid fa-trash"></i></button>`;
        } else {
            html += `<button class="tool-btn p0" style="color:#ff6b6b" onclick="deleteElement()"><i class="fa-solid fa-trash"></i></button>`;
        }
        toolbarContent.innerHTML = html;
    }

    function updateBtnLink(v) { if(selectedEl && v !== 'href') selectedEl.querySelector('a').setAttribute('href', v); }
    function updateBtnText(v) { if(selectedEl && v !== 'text') selectedEl.querySelector('a').innerText = v.toUpperCase(); }
    function deleteElement() { if(selectedEl) { selectedEl.remove(); deselectAll(); } }

    function setDevice(type) {
        currentMode = type;
        const widths = { 'desktop': 1200, 'android': 448, 'iphone': 393 };
        const scaleFactor = Math.min(wrapper.offsetWidth / widths[type], 1);
        frame.style.width = widths[type] + 'px';
        frame.style.height = (wrapper.offsetHeight / scaleFactor) + 'px';
        frame.style.transform = `scale(${scaleFactor})`;
        frame.style.left = (scaleFactor < 1) ? '0px' : ((wrapper.offsetWidth - widths[type]) / 2) + 'px';
    }

    function exportHTML() { console.log(frame.srcdoc); alert('HTML exported to console'); }

    window.addEventListener('resize', () => setDevice(currentMode));
    window.onload = init;
</script>
</body>
</html>
