<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Snoozing Builder | Step-by-Step</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --admin-bg: #1e1e1e;
            --panel-bg: #2d2d2d;
            --brand-pink: #ebd5c9;
            --text-light: #eee;
        }
        body { margin: 0; display: flex; height: 100vh; font-family: 'Source Sans Pro', sans-serif; background: #111; overflow: hidden; }

        /* LEFT CONTROL PANEL */
        #control-panel { width: 350px; background: var(--panel-bg); color: var(--text-light); display: flex; flex-direction: column; border-right: 2px solid #000; z-index: 10; }
        .tab-header { padding: 20px; background: #222; border-bottom: 1px solid #444; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; color: var(--brand-pink); }
        
        .scroll-area { flex-grow: 1; overflow-y: auto; padding: 20px; }
        .tool-section { margin-bottom: 30px; }
        .label { font-size: 10px; color: #888; text-transform: uppercase; margin-bottom: 12px; display: block; font-weight: bold; border-bottom: 1px solid #444; padding-bottom: 5px; }

        /* INSERT TABS (Draggable) */
        .drag-item { 
            background: #3d3d3d; border: 1px solid #555; padding: 15px; margin-bottom: 10px; 
            cursor: grab; border-radius: 4px; font-size: 12px; transition: 0.2s; display: flex; align-items: center;
        }
        .drag-item:hover { border-color: var(--brand-pink); background: #444; }
        .drag-item i { margin-right: 12px; color: var(--brand-pink); width: 15px; text-align: center; }

        /* FORMATTING TOOLBAR */
        #toolbar { display: none; background: #222; padding: 15px; border-top: 1px solid #444; }
        .tool-group { display: flex; gap: 8px; margin-bottom: 10px; justify-content: center; }
        .tool-btn { background: #444; border: 1px solid #666; color: #fff; padding: 8px 12px; cursor: pointer; border-radius: 3px; font-size: 14px; }
        .tool-btn:hover { background: var(--brand-pink); color: #000; }

        /* PREVIEW WINDOW */
        #preview-container { flex-grow: 1; background: #555; display: flex; justify-content: center; align-items: center; padding: 20px; position: relative; }
        #preview-frame { width: 100%; height: 100%; background: white; border: none; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

<div id="control-panel">
    <div class="tab-header">Insert Elements</div>
    
    <div class="scroll-area">
        <div class="tool-section">
            <span class="label">Drag to Preview</span>
            <div class="drag-item" draggable="true" ondragstart="onDragStart(event, 'section_heading')">
                <i class="fa-solid fa-font"></i> Section Heading
            </div>
            <div class="drag-item" draggable="true" ondragstart="onDragStart(event, 'block_heading')">
                <i class="fa-solid fa-heading"></i> Block Heading
            </div>
            <div class="drag-item" draggable="true" ondragstart="onDragStart(event, 'block_text')">
                <i class="fa-solid fa-paragraph"></i> Block Paragraph
            </div>
        </div>
    </div>

    <div id="toolbar">
        <span class="label">Text Alignment & Style</span>
        <div class="tool-group">
            <button class="tool-btn" onclick="applyFormat('justifyLeft')"><i class="fa-solid fa-align-left"></i></button>
            <button class="tool-btn" onclick="applyFormat('justifyCenter')"><i class="fa-solid fa-align-center"></i></button>
            <button class="tool-btn" onclick="applyFormat('justifyFull')"><i class="fa-solid fa-align-justify"></i></button>
        </div>
        <div class="tool-group">
            <button class="tool-btn" onclick="applyFormat('bold')"><i class="fa-solid fa-bold"></i></button>
            <button class="tool-btn" onclick="applyFormat('underline')"><i class="fa-solid fa-underline"></i></button>
        </div>
    </div>
</div>

<div id="preview-container">
    <iframe id="preview-frame"></iframe>
</div>

<script>
    const frame = document.getElementById('preview-frame');
    let templateHTML = "";

    // 1. INITIAL LOAD: FETCH EXTERNAL FILES
    async function loadResources() {
        try {
            // Fetch the template.html
            const response = await fetch('template.html');
            templateHTML = await response.text();
            
            // Inject the initial view
            renderPreview("<h2>Drag content into this area</h2>");
        } catch (err) {
            console.error("Could not load template.html or styles.css. Ensure you are running on a local server.", err);
        }
    }

    function renderPreview(content) {
        // This injects the template and ensures styles.css is called inside the iframe
        const doc = templateHTML.replace('{{CONTENT}}', `<div id="editor-root">${content}</div>`);
        frame.srcdoc = doc;
        
        // Setup listeners once the iframe loads
        frame.onload = () => {
            setupIframeInteractions();
        };
    }

    // 2. DRAG & DROP LOGIC
    function onDragStart(ev, type) {
        ev.dataTransfer.setData("text/type", type);
    }

    function setupIframeInteractions() {
        const innerDoc = frame.contentDocument || frame.contentWindow.document;
        const root = innerDoc.getElementById('editor-root');

        // Allow Dropping
        root.ondragover = (e) => e.preventDefault();
        root.ondrop = (e) => {
            e.preventDefault();
            const type = e.dataTransfer.getData("text/type");
            if(!type) return;

            const newEl = innerDoc.createElement('div');
            newEl.className = 'editable-block';
            newEl.contentEditable = "true";
            
            // Apply the styles from styles.css
            if(type === 'section_heading') newEl.innerHTML = `<div class="section_heading">NEW SECTION</div>`;
            if(type === 'block_heading')   newEl.innerHTML = `<h2 class="block_heading">Block Title</h2>`;
            if(type === 'block_text')      newEl.innerHTML = `<p class="block_text">Sample body text...</p>`;

            root.appendChild(newEl);
            attachBlockListeners(newEl);
        };
    }

    // 3. SELECTION & EDITING
    function attachBlockListeners(el) {
        el.onfocus = () => {
            document.getElementById('toolbar').style.display = 'block';
        };
        // Re-ordering logic would go here in next step
    }

    function applyFormat(cmd) {
        frame.contentWindow.document.execCommand(cmd, false, null);
    }

    window.onload = loadResources;
</script>

</body>
</html>
