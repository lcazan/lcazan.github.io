<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Snoozing Builder | CSS-Driven Editor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --admin-bg: #1e1e1e;
            --panel-bg: #2d2d2d;
            --brand-pink: #ebd5c9;
            --text-light: #eee;
        }
        body { margin: 0; display: flex; height: 100vh; font-family: 'Source Sans Pro', sans-serif; background: #111; overflow: hidden; }

        /* SIDEBAR PANEL */
        #sidebar { width: 380px; background: var(--panel-bg); display: flex; flex-direction: column; border-right: 2px solid #000; z-index: 100; }
        .tab-header { padding: 20px; background: #222; border-bottom: 1px solid #444; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; color: var(--brand-pink); }
        .tab-content { flex-grow: 1; overflow-y: auto; padding: 20px; }
        .label { font-size: 10px; color: #888; text-transform: uppercase; margin-bottom: 15px; display: block; border-bottom: 1px solid #444; padding-bottom: 5px; }

        /* INSERT BUTTONS */
        .insert-card { background: #3d3d3d; border: 1px solid #555; padding: 12px; margin-bottom: 10px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; color: #fff; }
        .btn-insert { background: var(--brand-pink); border: none; color: #000; padding: 5px 12px; border-radius: 3px; cursor: pointer; font-size: 10px; font-weight: bold; text-transform: uppercase; }

        /* TOOLBAR */
        #toolbar { display: none; margin-top: 20px; padding-top: 20px; border-top: 1px solid #444; }
        .tool-group { display: flex; gap: 8px; margin-bottom: 15px; }
        .tool-btn { background: #444; border: 1px solid #666; color: #fff; padding: 10px; cursor: pointer; border-radius: 3px; flex: 1; text-align: center; }
        .tool-btn:hover { background: var(--brand-pink); color: #000; }

        /* PREVIEW AREA */
        #preview-container { flex-grow: 1; height: 100vh; background: #555; position: relative; }
        #preview-frame { width: 100%; height: 100%; border: none; background: white; }
    </style>
</head>
<body>

<div id="sidebar">
    <div class="tab-header">Editor Controls</div>
    <div class="tab-content">
        <span class="label">Insert Elements</span>
        <div class="insert-card"><span>Section Heading</span><button class="btn-insert" onclick="insertElement('section_heading')">Add</button></div>
        <div class="insert-card"><span>Block Heading</span><button class="btn-insert" onclick="insertElement('block_heading')">Add</button></div>
        <div class="insert-card"><span>Block Text</span><button class="btn-insert" onclick="insertElement('block_text')">Add</button></div>

        <div id="toolbar">
            <span class="label">Text Style</span>
            <div class="tool-group">
                <button class="tool-btn" onclick="execCmd('bold')"><i class="fa-solid fa-bold"></i></button>
                <button class="tool-btn" id="underline-btn" onclick="execCmd('underline')"><i class="fa-solid fa-underline"></i></button>
            </div>
            
            <span class="label">Alignment</span>
            <div class="tool-group">
                <button class="tool-btn" onclick="execCmd('justifyLeft')"><i class="fa-solid fa-align-left"></i></button>
                <button class="tool-btn" onclick="execCmd('justifyCenter')"><i class="fa-solid fa-align-center"></i></button>
                <button class="tool-btn" onclick="execCmd('justifyFull')"><i class="fa-solid fa-align-justify"></i></button>
            </div>

            <button class="tool-btn" style="width:100%; background:#742a2a; border:none; margin-top: 10px;" onclick="deleteElement()">Delete Element</button>
        </div>
    </div>
</div>

<div id="preview-container">
    <iframe id="preview-frame"></iframe>
</div>

<script>
    const frame = document.getElementById('preview-frame');
    let selectedEl = null;

    async function init() {
        // Fetch external template
        const resp = await fetch('template.html');
        let html = await resp.text();
        
        // Ensure styles.css is loaded inside the head
        const cssLink = '<link rel="stylesheet" href="styles.css">';
        if (!html.includes('styles.css')) {
            html = html.replace('</head>', cssLink + '</head>');
        }
        
        // Target the correct content-container
        frame.srcdoc = html.replace('<div class="content-container">', '<div class="content-container" id="editor-root">');
        
        frame.onload = () => {
            const innerDoc = frame.contentDocument;
            
            // Interaction helpers
            const style = innerDoc.createElement('style');
            style.innerHTML = `
                .editable { cursor: text; min-height: 1.2em; transition: 0.1s; outline: none; }
                .editable:hover { outline: 1px dashed var(--brand-pink, #ebd5c9); outline-offset: 5px; }
                [contenteditable="true"]:focus { outline: 2px solid var(--icon-brown, #877267) !important; outline-offset: 5px; }
            `;
            innerDoc.head.appendChild(style);

            innerDoc.addEventListener('click', (e) => {
                if (!e.target.closest('.editable')) deselectAll();
            });
        };
    }

    function insertElement(type) {
        const root = frame.contentDocument.getElementById('editor-root');
        
        // Create the element with the exact class from styles.css
        const newEl = frame.contentDocument.createElement('div');
        newEl.className = `editable ${type}`; // e.g. "editable section_heading"
        newEl.contentEditable = "true";
        
        // Set placeholder content
        if(type === 'section_heading') newEl.innerText = "SECTION TITLE";
        if(type === 'block_heading') newEl.innerText = "Block Title Here";
        if(type === 'block_text') newEl.innerText = "Start typing your content here...";

        newEl.onfocus = () => {
            selectedEl = newEl;
            document.getElementById('toolbar').style.display = 'block';
            // Underline only for block_heading
            document.getElementById('underline-btn').style.display = 
                newEl.classList.contains('block_heading') ? 'block' : 'none';
        };

        root.appendChild(newEl);
        newEl.focus();
    }

    function deselectAll() {
        selectedEl = null;
        document.getElementById('toolbar').style.display = 'none';
        if(frame.contentDocument.activeElement) frame.contentDocument.activeElement.blur();
    }

    function execCmd(command) {
        frame.contentDocument.execCommand(command, false, null);
        frame.contentWindow.focus();
    }

    function deleteElement() {
        if(selectedEl) {
            selectedEl.remove();
            deselectAll();
        }
    }

    window.onload = init;
</script>

</body>
</html>
