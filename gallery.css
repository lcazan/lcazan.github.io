/* Force border-box globally to prevent 1px cutoffs */
* { box-sizing: border-box !important; }

body { 
    font-family: 'Segoe UI', sans-serif; 
    padding: 0; 
    margin: 0; 
    background: transparent; 
    overscroll-behavior: none; 
}

/* HARD LOCK: Physically prevents the window from scrolling while dragging */
body.sorting-active {
    overflow: hidden !important;
    touch-action: none !important;
    position: fixed; 
    width: 100%; 
    height: 100%;
}

#gallery-container { width: 100%; }

.photo_gallery { 
    display: grid; 
    grid-template-columns: repeat(3, 1fr); 
    gap: 6px; 
    width: 100%; 
}

.photo_gallery.masonry-mode { 
    display: block; 
    column-gap: 6px; 
    width: 100%; 
    column-count: 3; 
}

@media (max-width: 768px) { 
    .photo_gallery { grid-template-columns: repeat(2, 1fr); } 
    .photo_gallery.masonry-mode { column-count: 2; }
}

.gallery-item { 
    position: relative; 
    background: #fff; 
    border-radius: 6px; 
    overflow: hidden; 
    aspect-ratio: 1/1; 
    border: 1px solid #ddd; 
    width: 100%; 
}

.gallery-item img { 
    width: 100%; 
    height: 100%; 
    object-fit: cover; 
    display: block; 
    pointer-events: none; 
}

.masonry-mode .gallery-item { 
    display: inline-block; 
    width: 100%; 
    aspect-ratio: auto; 
    margin-bottom: 6px; 
    vertical-align: top; 
}

.masonry-mode .gallery-item img { 
    height: auto; 
    object-fit: contain; 
}

.sentry-layer { 
    position: absolute; 
    inset: 0; 
    z-index: 20; 
    background: transparent; 
}

.gallery-item.active .sentry-layer { z-index: -1; }

.pan-overlay { 
    position: absolute; 
    inset: 0; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    background: rgba(0,0,0,0.25); 
    color: rgba(255, 255, 255, 0.4); 
    font-size: 50px; 
    opacity: 0; 
    transition: 0.2s; 
    cursor: move; 
    z-index: 5; 
}

.gallery-item.active .pan-overlay { opacity: 1; }
.masonry-mode .pan-overlay { display: none !important; }

.item-actions { 
    position: absolute; 
    top: 10px; 
    right: 10px; 
    display: flex; 
    gap: 6px; 
    opacity: 0; 
    z-index: 10; 
    transition: 0.2s; 
}

.gallery-item.active .item-actions { opacity: 1; }

.action-btn { 
    width: 36px; 
    height: 36px; 
    background: rgba(0,0,0,0.8); 
    color: white; 
    border: none; 
    border-radius: 5px; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    cursor: pointer; 
}

/* Dragula UI logic */
.drag-handle { 
    background: #877267; 
    cursor: grab; 
    touch-action: none !important; 
}

.gu-mirror {
    position: fixed !important;
    margin: 0 !important;
    z-index: 9999 !important;
    opacity: 0.8;
    scale: 1.05;
    pointer-events: none;
}

/* Menu logic */
.choice-menu { 
    position: absolute; 
    inset: 0; 
    background: rgba(255,255,255,0.98); 
    display: flex; 
    flex-direction: column; 
    justify-content: center; 
    align-items: center; 
    gap: 12px; 
    z-index: 100; 
    opacity: 0; 
    pointer-events: none; 
}

.gallery-item.menu-open .choice-menu { 
    opacity: 1; 
    pointer-events: auto; 
}

.choice-btn { 
    width: 80%; 
    padding: 12px; 
    border: none; 
    background: #3498db; 
    color: white; 
    border-radius: 6px; 
    font-weight: 600; 
    cursor: pointer; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    gap: 10px; 
}

.gallery-empty-slot { 
    border: 2px dashed #bbb; 
    cursor: pointer; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    background: #eee; 
}

.gallery-empty-slot::before { 
    content: '+'; 
    font-size: 50px; 
    color: #aaa; 
}
